<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>
    <style>
        body { font-family: -apple-system, sans-serif; display: flex; justify-content: flex-start; align-items: center; height: 100%; background: #f8fafc; margin: 0; color: #64748b; }
        .loader { border: 3px solid #e2e8f0; border-top: 3px solid #2563eb; border-radius: 50%; width: 28px; height: 28px; animation: spin 1s linear infinite; margin-bottom: 12px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #status-wrap { text-align: center; }
        #profile-root { display: none; width: 100%; }
    </style>
</head>
<body>

    <div id="status-wrap">
        <div class="loader"></div>
        <div id="msg">Connecting...</div>
    </div>

    <div id="profile-root"></div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwmSwq2K_xX6qCWfIZNHzeJzTgUuhoX7nJooe3ZWv00NhVed-q7LBxegHzKKhuKGcPmZA/exec";

        async function init() {
            const pathSegments = window.location.pathname.split('/').filter(p => p && p !== 'urprofile');
            const slug = pathSegments[0]; 

            if (!slug || slug === "index.html") {
                window.location.href = "/urprofile/index.html";
                return;
            }

            try {
                const response = await fetch(`${API_URL}?u=${slug}`);
                const result = await response.json();

                if (result.success) {
                    const templateName = result.data.temp || 'p1';
                    const tResponse = await fetch(`/urprofile/${templateName}.html`);
                    const tHtml = await tResponse.text();

                    document.getElementById('status-wrap').remove();
                    const root = document.getElementById('profile-root');
                    root.innerHTML = tHtml;
                    root.style.display = 'block';

                    paint(result.data);
                } else {
                    document.getElementById('status-wrap').innerHTML = "Profile not found.";
                }
            } catch (e) {
                document.getElementById('status-wrap').innerHTML = "Error loading profile.";
            }
        }

        function paint(data) {
            document.title = data.name || "Profile";
            
            // 1. Basic Info
            if(document.querySelector('.p-name')) document.querySelector('.p-name').innerText = data.name;
            if(document.querySelector('.p-bio')) document.querySelector('.p-bio').innerText = data.bio;
            if(document.querySelector('.p-pfp') && data.pfp) {
                document.querySelector('.p-pfp').src = data.pfp;
                document.querySelector('.p-pfp').style.display = 'block';
            }

            // 2. Main Links (1-5) - Synced to your link1_text, link1_url, etc.
            const linkList = document.querySelector('.p-links');
            if(linkList) {
                for(let i=1; i<=5; i++) {
                    const txt = data[`link${i}_text`];
                    const url = data[`link${i}_url`];
                    if(txt && url) {
                        const a = document.createElement('a');
                        a.className = 'p-link-btn';
                        a.innerText = txt;
                        a.href = url.startsWith('http') ? url : 'https://' + url;
                        a.target = "_blank";
                        linkList.appendChild(a);
                    }
                }
            }

            // 3. YouTube Video Injection
            const ytEl = document.querySelector('.p-yt');
            if(ytEl && data.yt_video) {
                const vidId = data.yt_video.includes('v=') ? data.yt_video.split('v=')[1].split('&')[0] : data.yt_video;
                ytEl.innerHTML = `<iframe width="100%" height="250" src="https://www.youtube.com/embed/${vidId}" frameborder="0" allowfullscreen></iframe>`;
                ytEl.style.display = 'block';
            }

            // 4. Social Media Icons - Synced to ig, wa, fb, li, tw, tel, email
            const socialWrap = document.querySelector('.p-socials');
            if(socialWrap) {
                const socialConfig = [
                    {key: 'wa', label: 'WhatsApp', base: 'https://wa.me/'},
                    {key: 'ig', label: 'Instagram', base: 'https://instagram.com/'},
                    {key: 'fb', label: 'Facebook', base: 'https://facebook.com/'},
                    {key: 'li', label: 'LinkedIn', base: 'https://linkedin.com/in/'},
                    {key: 'tw', label: 'X', base: 'https://twitter.com/'},
                    {key: 'tel', label: 'Call', base: 'tel:'},
                    {key: 'email', label: 'Email', base: 'mailto:'}
                ];
                socialConfig.forEach(s => {
                    if(data[s.key]) {
                        const icon = document.createElement('a');
                        icon.href = s.base + data[s.key];
                        icon.innerText = s.label;
                        icon.className = 'p-social-icon';
                        icon.target = "_blank";
                        socialWrap.appendChild(icon);
                    }
                });
            }
        }
        init();
    </script>
</body>
</html>





